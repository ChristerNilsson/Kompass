// Generated by CoffeeScript 2.7.0
// Målkoordinater (t.ex. Brandparken)
var calculateBearing, f, previousPosition, targetLat, targetLon, toDegrees, toRadians, updateArrow, watchError;

targetLat = 59.266338;

targetLon = 18.131969;

previousPosition = null;

toRadians = function(deg) {
  return deg * Math.PI / 180;
};

toDegrees = function(rad) {
  return rad * 180 / Math.PI;
};

calculateBearing = function(lat1, lon1, lat2, lon2) {
  var x, y, Δλ, φ1, φ2;
  φ1 = toRadians(lat1);
  φ2 = toRadians(lat2);
  Δλ = toRadians(lon2 - lon1);
  y = Math.sin(Δλ) * Math.cos(φ2);
  x = Math.cos(φ1) * Math.sin(φ2) - Math.sin(φ1) * Math.cos(φ2) * Math.cos(Δλ);
  return (toDegrees(Math.atan2(y, x)) + 360) % 360;
};

updateArrow = function(bearingToTarget) {
  var arrow;
  arrow = document.getElementById('arrow');
  return arrow.style.transform = `rotate(${bearingToTarget}deg)`;
};

f = function(position) {
  var latitude, longitude, movementBearing, relativeBearing, targetBearing;
  ({latitude, longitude} = position.coords);
  if (previousPosition != null) {
    movementBearing = calculateBearing(previousPosition.latitude, previousPosition.longitude, latitude, longitude);
    targetBearing = calculateBearing(latitude, longitude, targetLat, targetLon);
    relativeBearing = (targetBearing - movementBearing + 360) % 360;
    updateArrow(relativeBearing);
    document.getElementById('debug').innerText = `Din riktning: ${Math.round(movementBearing)}°, Mål: ${Math.round(targetBearing)}°, Relativt: ${Math.round(relativeBearing)}°`;
  }
  return previousPosition = {
    latitude: latitude,
    longitude: longitude
  };
};

watchError = function(error) {
  alert("Kunde inte hämta GPS-position");
  return console.error(error);
};

navigator.geolocation.watchPosition(f, watchError, {
  enableHighAccuracy: true,
  maximumAge: 1000,
  timeout: 5000
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tldGNoLmpzIiwic291cmNlUm9vdCI6IlxcIiwic291cmNlcyI6WyJza2V0Y2guY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDb0M7QUFBQSxJQUFBLGdCQUFBLEVBQUEsQ0FBQSxFQUFBLGdCQUFBLEVBQUEsU0FBQSxFQUFBLFNBQUEsRUFBQSxTQUFBLEVBQUEsU0FBQSxFQUFBLFdBQUEsRUFBQTs7QUFDbEMsU0FBQSxHQUFZOztBQUNaLFNBQUEsR0FBWTs7QUFFWixnQkFBQSxHQUFtQjs7QUFFbkIsU0FBQSxHQUFZLFFBQUEsQ0FBQyxHQUFELENBQUE7U0FBUyxHQUFBLEdBQU0sSUFBSSxDQUFDLEVBQVgsR0FBZ0I7QUFBekI7O0FBQ1osU0FBQSxHQUFZLFFBQUEsQ0FBQyxHQUFELENBQUE7U0FBUyxHQUFBLEdBQU0sR0FBTixHQUFZLElBQUksQ0FBQztBQUExQjs7QUFFWixnQkFBQSxHQUFtQixRQUFBLENBQUMsSUFBRCxFQUFPLElBQVAsRUFBYSxJQUFiLEVBQW1CLElBQW5CLENBQUE7QUFDcEIsTUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUE7RUFBQyxFQUFBLEdBQUssU0FBQSxDQUFVLElBQVY7RUFDTCxFQUFBLEdBQUssU0FBQSxDQUFVLElBQVY7RUFDTCxFQUFBLEdBQUssU0FBQSxDQUFVLElBQUEsR0FBTyxJQUFqQjtFQUNMLENBQUEsR0FBSSxJQUFJLENBQUMsR0FBTCxDQUFTLEVBQVQsQ0FBQSxHQUFlLElBQUksQ0FBQyxHQUFMLENBQVMsRUFBVDtFQUNuQixDQUFBLEdBQUksSUFBSSxDQUFDLEdBQUwsQ0FBUyxFQUFULENBQUEsR0FBZSxJQUFJLENBQUMsR0FBTCxDQUFTLEVBQVQsQ0FBZixHQUE4QixJQUFJLENBQUMsR0FBTCxDQUFTLEVBQVQsQ0FBQSxHQUFlLElBQUksQ0FBQyxHQUFMLENBQVMsRUFBVCxDQUFmLEdBQThCLElBQUksQ0FBQyxHQUFMLENBQVMsRUFBVDtTQUNoRSxDQUFDLFNBQUEsQ0FBVSxJQUFJLENBQUMsS0FBTCxDQUFXLENBQVgsRUFBYyxDQUFkLENBQVYsQ0FBQSxHQUE4QixHQUEvQixDQUFBLEdBQXNDO0FBTm5COztBQVFuQixXQUFBLEdBQWMsUUFBQSxDQUFDLGVBQUQsQ0FBQTtBQUNmLE1BQUE7RUFBQyxLQUFBLEdBQVEsUUFBUSxDQUFDLGNBQVQsQ0FBd0IsT0FBeEI7U0FDUixLQUFLLENBQUMsS0FBSyxDQUFDLFNBQVosR0FBd0IsQ0FBQSxPQUFBLENBQUEsQ0FBVSxlQUFWLENBQUEsSUFBQTtBQUZWOztBQUlkLENBQUEsR0FBSSxRQUFBLENBQUMsUUFBRCxDQUFBO0FBQ0wsTUFBQSxRQUFBLEVBQUEsU0FBQSxFQUFBLGVBQUEsRUFBQSxlQUFBLEVBQUE7RUFBQyxDQUFBLENBQUMsUUFBRCxFQUFXLFNBQVgsQ0FBQSxHQUF3QixRQUFRLENBQUMsTUFBakM7RUFFQSxJQUFHLHdCQUFIO0lBQ0MsZUFBQSxHQUFrQixnQkFBQSxDQUFpQixnQkFBZ0IsQ0FBQyxRQUFsQyxFQUE0QyxnQkFBZ0IsQ0FBQyxTQUE3RCxFQUF3RSxRQUF4RSxFQUFrRixTQUFsRjtJQUNsQixhQUFBLEdBQWdCLGdCQUFBLENBQWlCLFFBQWpCLEVBQTJCLFNBQTNCLEVBQXNDLFNBQXRDLEVBQWlELFNBQWpEO0lBQ2hCLGVBQUEsR0FBa0IsQ0FBQyxhQUFBLEdBQWdCLGVBQWhCLEdBQWtDLEdBQW5DLENBQUEsR0FBMEM7SUFDNUQsV0FBQSxDQUFZLGVBQVo7SUFDQSxRQUFRLENBQUMsY0FBVCxDQUF3QixPQUF4QixDQUFnQyxDQUFDLFNBQWpDLEdBQTZDLENBQUEsY0FBQSxDQUFBLENBQWlCLElBQUksQ0FBQyxLQUFMLENBQVcsZUFBWCxDQUFqQixDQUFBLFFBQUEsQ0FBQSxDQUF1RCxJQUFJLENBQUMsS0FBTCxDQUFXLGFBQVgsQ0FBdkQsQ0FBQSxhQUFBLENBQUEsQ0FBZ0csSUFBSSxDQUFDLEtBQUwsQ0FBVyxlQUFYLENBQWhHLENBQUEsQ0FBQSxFQUw5Qzs7U0FPQSxnQkFBQSxHQUNDO0lBQUEsUUFBQSxFQUFVLFFBQVY7SUFDQSxTQUFBLEVBQVc7RUFEWDtBQVhHOztBQWNKLFVBQUEsR0FBYSxRQUFBLENBQUMsS0FBRCxDQUFBO0VBQ2IsS0FBQSxDQUFNLCtCQUFOO1NBQ0EsT0FBTyxDQUFDLEtBQVIsQ0FBYyxLQUFkO0FBRmE7O0FBSWIsU0FBUyxDQUFDLFdBQVcsQ0FBQyxhQUF0QixDQUFvQyxDQUFwQyxFQUF1QyxVQUF2QyxFQUFtRDtFQUFDLGtCQUFBLEVBQW9CLElBQXJCO0VBQTJCLFVBQUEsRUFBWSxJQUF2QztFQUE2QyxPQUFBLEVBQVM7QUFBdEQsQ0FBbkQiLCJzb3VyY2VzQ29udGVudCI6WyJcclxuIyBNw6Vsa29vcmRpbmF0ZXIgKHQuZXguIEJyYW5kcGFya2VuKVxyXG50YXJnZXRMYXQgPSA1OS4yNjYzMzhcclxudGFyZ2V0TG9uID0gMTguMTMxOTY5XHJcblxyXG5wcmV2aW91c1Bvc2l0aW9uID0gbnVsbFxyXG5cclxudG9SYWRpYW5zID0gKGRlZykgLT4gZGVnICogTWF0aC5QSSAvIDE4MFxyXG50b0RlZ3JlZXMgPSAocmFkKSAtPiByYWQgKiAxODAgLyBNYXRoLlBJXHJcblxyXG5jYWxjdWxhdGVCZWFyaW5nID0gKGxhdDEsIGxvbjEsIGxhdDIsIGxvbjIpIC0+XHJcblx0z4YxID0gdG9SYWRpYW5zIGxhdDFcclxuXHTPhjIgPSB0b1JhZGlhbnMgbGF0MlxyXG5cdM6UzrsgPSB0b1JhZGlhbnMgbG9uMiAtIGxvbjFcclxuXHR5ID0gTWF0aC5zaW4ozpTOuykgKiBNYXRoLmNvcyjPhjIpXHJcblx0eCA9IE1hdGguY29zKM+GMSkgKiBNYXRoLnNpbijPhjIpIC0gTWF0aC5zaW4oz4YxKSAqIE1hdGguY29zKM+GMikgKiBNYXRoLmNvcyjOlM67KVxyXG5cdCh0b0RlZ3JlZXMoTWF0aC5hdGFuMih5LCB4KSkgKyAzNjApICUgMzYwXHJcblxyXG51cGRhdGVBcnJvdyA9IChiZWFyaW5nVG9UYXJnZXQpIC0+XHJcblx0YXJyb3cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXJyb3cnKVxyXG5cdGFycm93LnN0eWxlLnRyYW5zZm9ybSA9IFwicm90YXRlKCN7YmVhcmluZ1RvVGFyZ2V0fWRlZylcIlxyXG5cclxuZiA9IChwb3NpdGlvbikgLT5cclxuXHR7bGF0aXR1ZGUsIGxvbmdpdHVkZX0gPSBwb3NpdGlvbi5jb29yZHNcclxuXHJcblx0aWYgcHJldmlvdXNQb3NpdGlvbj9cclxuXHRcdG1vdmVtZW50QmVhcmluZyA9IGNhbGN1bGF0ZUJlYXJpbmcgcHJldmlvdXNQb3NpdGlvbi5sYXRpdHVkZSwgcHJldmlvdXNQb3NpdGlvbi5sb25naXR1ZGUsIGxhdGl0dWRlLCBsb25naXR1ZGVcclxuXHRcdHRhcmdldEJlYXJpbmcgPSBjYWxjdWxhdGVCZWFyaW5nIGxhdGl0dWRlLCBsb25naXR1ZGUsIHRhcmdldExhdCwgdGFyZ2V0TG9uXHJcblx0XHRyZWxhdGl2ZUJlYXJpbmcgPSAodGFyZ2V0QmVhcmluZyAtIG1vdmVtZW50QmVhcmluZyArIDM2MCkgJSAzNjBcclxuXHRcdHVwZGF0ZUFycm93IHJlbGF0aXZlQmVhcmluZ1xyXG5cdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlYnVnJykuaW5uZXJUZXh0ID0gXCJEaW4gcmlrdG5pbmc6ICN7TWF0aC5yb3VuZChtb3ZlbWVudEJlYXJpbmcpfcKwLCBNw6VsOiAje01hdGgucm91bmQodGFyZ2V0QmVhcmluZyl9wrAsIFJlbGF0aXZ0OiAje01hdGgucm91bmQocmVsYXRpdmVCZWFyaW5nKX3CsFwiXHJcblxyXG5cdHByZXZpb3VzUG9zaXRpb24gPVxyXG5cdFx0bGF0aXR1ZGU6IGxhdGl0dWRlXHJcblx0XHRsb25naXR1ZGU6IGxvbmdpdHVkZVxyXG5cclxud2F0Y2hFcnJvciA9IChlcnJvcikgLT5cclxuXHRhbGVydCBcIkt1bmRlIGludGUgaMOkbXRhIEdQUy1wb3NpdGlvblwiXHJcblx0Y29uc29sZS5lcnJvciBlcnJvclxyXG5cclxubmF2aWdhdG9yLmdlb2xvY2F0aW9uLndhdGNoUG9zaXRpb24gZixcdHdhdGNoRXJyb3IsIHtlbmFibGVIaWdoQWNjdXJhY3k6IHRydWUsIG1heGltdW1BZ2U6IDEwMDAsIHRpbWVvdXQ6IDUwMDB9XHJcblxyXG4iXX0=
//# sourceURL=c:\github\Kompass\sketch.coffee