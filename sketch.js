// Generated by CoffeeScript 2.7.0
// Målkoordinater (t.ex. Brandparken)
var calculateBearing, calculateDistance, dump, f, messages, previousPosition, radians, targetLat, targetLon, toDegrees, toRadians, updateArrow, watchError;

targetLat = 59.266338;

targetLon = 18.131969;

previousPosition = null;

toRadians = function(deg) {
  return deg * Math.PI / 180;
};

toDegrees = function(rad) {
  return rad * 180 / Math.PI;
};

messages = [];

dump = function(msg) {
  messages.unshift(msg);
  if (messages.length > 20) {
    messages.pop();
  }
  return document.getElementById('debug').innerText = messages.join("\n");
};

radians = function(deg) {
  return deg * Math.PI / 180;
};

calculateDistance = function(lat1, lon1, lat2, lon2) {
  var R, a, c, dLat, dLon;
  R = 6371000;
  dLat = radians(lat2 - lat1);
  dLon = radians(lon2 - lon1);
  a = Math.sin(dLat / 2) ** 2 + Math.cos(radians(lat1)) * Math.cos(radians(lat2)) * Math.sin(dLon / 2) ** 2;
  c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
};

calculateBearing = function(lat1, lon1, lat2, lon2) {
  var x, y, Δλ, φ1, φ2;
  φ1 = toRadians(lat1);
  φ2 = toRadians(lat2);
  Δλ = toRadians(lon2 - lon1);
  y = Math.sin(Δλ) * Math.cos(φ2);
  x = Math.cos(φ1) * Math.sin(φ2) - Math.sin(φ1) * Math.cos(φ2) * Math.cos(Δλ);
  return (toDegrees(Math.atan2(y, x)) + 360) % 360;
};

updateArrow = function(bearingToTarget) {
  var arrow;
  arrow = document.getElementById('arrow');
  return arrow.style.transform = `rotate(${bearingToTarget}deg)`;
};

f = function(position) {
  var latitude, longitude, movementBearing, movementDistance, relativeBearing, targetBearing;
  ({latitude, longitude} = position.coords);
  if (previousPosition != null) {
    movementBearing = calculateBearing(previousPosition.latitude, previousPosition.longitude, latitude, longitude);
    movementDistance = calculateDistance(targetLat, targetLon, latitude, longitude);
    targetBearing = calculateBearing(latitude, longitude, targetLat, targetLon);
    relativeBearing = (targetBearing - movementBearing + 360) % 360;
    updateArrow(relativeBearing);
    dump(`M:${Math.round(movementBearing)}° T:${Math.round(targetBearing)}° R:${Math.round(relativeBearing)}° ${Math.round(movementDistance)}`);
  }
  return previousPosition = {
    latitude: latitude,
    longitude: longitude
  };
};

watchError = function(error) {
  return dump("Kunde inte hämta GPS-position"); // #{error}"
};

navigator.geolocation.watchPosition(f, watchError, {
  enableHighAccuracy: true,
  maximumAge: 1000,
  timeout: 5000
});

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tldGNoLmpzIiwic291cmNlUm9vdCI6IlxcIiwic291cmNlcyI6WyJza2V0Y2guY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDb0M7QUFBQSxJQUFBLGdCQUFBLEVBQUEsaUJBQUEsRUFBQSxJQUFBLEVBQUEsQ0FBQSxFQUFBLFFBQUEsRUFBQSxnQkFBQSxFQUFBLE9BQUEsRUFBQSxTQUFBLEVBQUEsU0FBQSxFQUFBLFNBQUEsRUFBQSxTQUFBLEVBQUEsV0FBQSxFQUFBOztBQUNsQyxTQUFBLEdBQVk7O0FBQ1osU0FBQSxHQUFZOztBQUVaLGdCQUFBLEdBQW1COztBQUVuQixTQUFBLEdBQVksUUFBQSxDQUFDLEdBQUQsQ0FBQTtTQUFTLEdBQUEsR0FBTSxJQUFJLENBQUMsRUFBWCxHQUFnQjtBQUF6Qjs7QUFDWixTQUFBLEdBQVksUUFBQSxDQUFDLEdBQUQsQ0FBQTtTQUFTLEdBQUEsR0FBTSxHQUFOLEdBQVksSUFBSSxDQUFDO0FBQTFCOztBQUVaLFFBQUEsR0FBVzs7QUFFWCxJQUFBLEdBQU8sUUFBQSxDQUFDLEdBQUQsQ0FBQTtFQUNQLFFBQVEsQ0FBQyxPQUFULENBQWlCLEdBQWpCO0VBQ0EsSUFBRyxRQUFRLENBQUMsTUFBVCxHQUFrQixFQUFyQjtJQUE2QixRQUFRLENBQUMsR0FBVCxDQUFBLEVBQTdCOztTQUNBLFFBQVEsQ0FBQyxjQUFULENBQXdCLE9BQXhCLENBQWdDLENBQUMsU0FBakMsR0FBNkMsUUFBUSxDQUFDLElBQVQsQ0FBYyxJQUFkO0FBSHRDOztBQUtQLE9BQUEsR0FBVSxRQUFBLENBQUMsR0FBRCxDQUFBO1NBQVMsR0FBQSxHQUFNLElBQUksQ0FBQyxFQUFYLEdBQWdCO0FBQXpCOztBQUNWLGlCQUFBLEdBQW9CLFFBQUEsQ0FBQyxJQUFELEVBQU8sSUFBUCxFQUFhLElBQWIsRUFBbUIsSUFBbkIsQ0FBQTtBQUNyQixNQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLElBQUEsRUFBQTtFQUFDLENBQUEsR0FB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LElBQUEsQ0FBQSxDQUF1RSxJQUFJLENBQUMsS0FBTCxDQUFXLGVBQVgsQ0FBdkUsQ0FBQSxFQUFBLENBQUEsQ0FBdUcsSUFBSSxDQUFDLEtBQUwsQ0FBVyxnQkFBWCxDQUF2RyxDQUFBLENBQUwsRUFORDs7U0FRQSxnQkFBQSxHQUNDO0lBQUEsUUFBQSxFQUFVLFFBQVY7SUFDQSxTQUFBLEVBQVc7RUFEWDtBQVpHOztBQWVKLFVBQUEsR0FBYSxRQUFBLENBQUMsS0FBRCxDQUFBO1NBQVcsSUFBQSxDQUFLLCtCQUFMLEVBQVg7QUFBQTs7QUFFYixTQUFTLENBQUMsV0FBVyxDQUFDLGFBQXRCLENBQW9DLENBQXBDLEVBQXVDLFVBQXZDLEVBQW1EO0VBQUMsa0JBQUEsRUFBb0IsSUFBckI7RUFBMkIsVUFBQSxFQUFZLElBQXZDO0VBQTZDLE9BQUEsRUFBUztBQUF0RCxDQUFuRCIsInNvdXJjZXNDb250ZW50IjpbIlxyXG4jIE3DpWxrb29yZGluYXRlciAodC5leC4gQnJhbmRwYXJrZW4pXHJcbnRhcmdldExhdCA9IDU5LjI2NjMzOFxyXG50YXJnZXRMb24gPSAxOC4xMzE5NjlcclxuXHJcbnByZXZpb3VzUG9zaXRpb24gPSBudWxsXHJcblxyXG50b1JhZGlhbnMgPSAoZGVnKSAtPiBkZWcgKiBNYXRoLlBJIC8gMTgwXHJcbnRvRGVncmVlcyA9IChyYWQpIC0+IHJhZCAqIDE4MCAvIE1hdGguUElcclxuXHJcbm1lc3NhZ2VzID0gW11cclxuXHJcbmR1bXAgPSAobXNnKSAtPlxyXG5cdG1lc3NhZ2VzLnVuc2hpZnQgbXNnXHJcblx0aWYgbWVzc2FnZXMubGVuZ3RoID4gMjAgdGhlbiBtZXNzYWdlcy5wb3AoKVxyXG5cdGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZWJ1ZycpLmlubmVyVGV4dCA9IG1lc3NhZ2VzLmpvaW4gXCJcXG5cIlxyXG5cclxucmFkaWFucyA9IChkZWcpIC0+IGRlZyAqIE1hdGguUEkgLyAxODBcclxuY2FsY3VsYXRlRGlzdGFuY2UgPSAobGF0MSwgbG9uMSwgbGF0MiwgbG9uMikgLT5cclxuXHRSID0gNjM3MTAwMFxyXG5cdGRMYXQgPSByYWRpYW5zIGxhdDIgLSBsYXQxXHJcblx0ZExvbiA9IHJhZGlhbnMgbG9uMiAtIGxvbjFcclxuXHRhID0gTWF0aC5zaW4oZExhdC8yKSoqMiArIE1hdGguY29zKHJhZGlhbnMobGF0MSkpICogTWF0aC5jb3MocmFkaWFucyhsYXQyKSkgKiBNYXRoLnNpbihkTG9uLzIpKioyXHJcblx0YyA9IDIgKiBNYXRoLmF0YW4yKE1hdGguc3FydChhKSwgTWF0aC5zcXJ0KDEgLSBhKSlcclxuXHRSICogY1xyXG5cclxuY2FsY3VsYXRlQmVhcmluZyA9IChsYXQxLCBsb24xLCBsYXQyLCBsb24yKSAtPlxyXG5cdM+GMSA9IHRvUmFkaWFucyBsYXQxXHJcblx0z4YyID0gdG9SYWRpYW5zIGxhdDJcclxuXHTOlM67ID0gdG9SYWRpYW5zIGxvbjIgLSBsb24xXHJcblx0eSA9IE1hdGguc2luKM6UzrspICogTWF0aC5jb3Moz4YyKVxyXG5cdHggPSBNYXRoLmNvcyjPhjEpICogTWF0aC5zaW4oz4YyKSAtIE1hdGguc2luKM+GMSkgKiBNYXRoLmNvcyjPhjIpICogTWF0aC5jb3MozpTOuylcclxuXHQodG9EZWdyZWVzKE1hdGguYXRhbjIoeSwgeCkpICsgMzYwKSAlIDM2MFxyXG5cclxudXBkYXRlQXJyb3cgPSAoYmVhcmluZ1RvVGFyZ2V0KSAtPlxyXG5cdGFycm93ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Fycm93JylcclxuXHRhcnJvdy5zdHlsZS50cmFuc2Zvcm0gPSBcInJvdGF0ZSgje2JlYXJpbmdUb1RhcmdldH1kZWcpXCJcclxuXHJcbmYgPSAocG9zaXRpb24pIC0+XHJcblx0e2xhdGl0dWRlLCBsb25naXR1ZGV9ID0gcG9zaXRpb24uY29vcmRzXHJcblxyXG5cdGlmIHByZXZpb3VzUG9zaXRpb24/XHJcblx0XHRtb3ZlbWVudEJlYXJpbmcgPSBjYWxjdWxhdGVCZWFyaW5nIHByZXZpb3VzUG9zaXRpb24ubGF0aXR1ZGUsIHByZXZpb3VzUG9zaXRpb24ubG9uZ2l0dWRlLCBsYXRpdHVkZSwgbG9uZ2l0dWRlXHJcblx0XHRtb3ZlbWVudERpc3RhbmNlID0gY2FsY3VsYXRlRGlzdGFuY2UgdGFyZ2V0TGF0LCB0YXJnZXRMb24sIGxhdGl0dWRlLCBsb25naXR1ZGVcclxuXHRcdHRhcmdldEJlYXJpbmcgPSBjYWxjdWxhdGVCZWFyaW5nIGxhdGl0dWRlLCBsb25naXR1ZGUsIHRhcmdldExhdCwgdGFyZ2V0TG9uXHJcblx0XHRyZWxhdGl2ZUJlYXJpbmcgPSAodGFyZ2V0QmVhcmluZyAtIG1vdmVtZW50QmVhcmluZyArIDM2MCkgJSAzNjBcclxuXHRcdHVwZGF0ZUFycm93IHJlbGF0aXZlQmVhcmluZ1xyXG5cdFx0ZHVtcCBcIk06I3tNYXRoLnJvdW5kKG1vdmVtZW50QmVhcmluZyl9wrAgVDoje01hdGgucm91bmQodGFyZ2V0QmVhcmluZyl9wrAgUjoje01hdGgucm91bmQocmVsYXRpdmVCZWFyaW5nKX3CsCAje01hdGgucm91bmQgbW92ZW1lbnREaXN0YW5jZX1cIlxyXG5cclxuXHRwcmV2aW91c1Bvc2l0aW9uID1cclxuXHRcdGxhdGl0dWRlOiBsYXRpdHVkZVxyXG5cdFx0bG9uZ2l0dWRlOiBsb25naXR1ZGVcclxuXHJcbndhdGNoRXJyb3IgPSAoZXJyb3IpIC0+IGR1bXAgXCJLdW5kZSBpbnRlIGjDpG10YSBHUFMtcG9zaXRpb25cIiAjICN7ZXJyb3J9XCJcclxuXHJcbm5hdmlnYXRvci5nZW9sb2NhdGlvbi53YXRjaFBvc2l0aW9uIGYsXHR3YXRjaEVycm9yLCB7ZW5hYmxlSGlnaEFjY3VyYWN5OiB0cnVlLCBtYXhpbXVtQWdlOiAxMDAwLCB0aW1lb3V0OiA1MDAwfVxyXG5cclxuIl19
//# sourceURL=c:\github\Kompass\sketch.coffee